<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Ayush Kumar | Data Portfolio</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="Free Website Template" name="keywords">
        <meta content="Free Website Template" name="description">

        <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon">

        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

        <!-- CSS Libraries -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
        <link href="lib/animate/animate.min.css" rel="stylesheet">
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
        <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet">

        <link rel="icon" href="img/portfolio-icon.png" sizes="16x16" type="image/png">
	    <link rel="icon" href="img/portfolio-icon.png" sizes="32x32" type="image/png">
	    <link rel="icon" href="img/portfolio-icon.png" sizes="48x48" type="image/png">
	    <link rel="icon" href="img/portfolio-icon.png" sizes="64x64" type="image/png">
	    <link rel="icon" href="img/portfolio-icon.png" sizes="128x128" type="image/png">

        <style>
            .code-container {
                background-color: white;
                padding: 15px;
                padding-left: 15px;
                padding-bottom: 15px;
                padding-right: 15px;
                border-radius: 10px;
            }
            .code-comment {
                color:green;
            }
        </style>
    </head>

    <body data-spy="scroll" data-target=".navbar" data-offset="51">
        <!-- Nav Bar Start -->
        <div class="navbar navbar-expand-lg bg-light navbar-light">
            <div class="container-fluid">
                <a href="index.html" class="navbar-brand">AYUSH KUMAR</a>
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                    <div class="navbar-nav ml-auto">
                        <!--<a href="#currentblog" class="nav-item nav-link">Blog</a>-->
                        <a href="index.html" class="nav-item nav-link">Home</a>
                        <a href="#portfolio" class="nav-item nav-link">Portfolio</a>
                        <a href="#contact" class="nav-item nav-link">Contact</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Nav Bar End -->


        <!-- Hero Start -->
        <div class="hero" id="currentblog">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-sm-10">
                        <div class="hero-content">
                            <div class="hero-text">
                                <p>Web Scraping Using API</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hero End -->


        <!-- About Start -->
        <div class="service" data-wow-delay="0.1s" id="about">
            <div class="container-fluid">
                
                <div class="container banner-text text-left" style="max-width: 800px;">
                    <p>
                        <p class="text-justify">In this blog post, we will walk through the process of building a data scraper for Zomato, one of the leading food delivery platforms. The process will be broken down into three main steps: fetching paginated order data using Zomato's API, extracting detailed order information for each item, and transforming the data into CSV files for analysis. We will use Python along with its `requests` package to automate web requests.</p>
                        <br><hr><br>
                        <h5>Prerequisites</h5>
                        <ul class="text-justify">
                            <li>Basic knowledge of Python and web APIs.</li>
                            <li>A Zomato account to fetch the necessary headers for authentication.</li>
                            <li>Python libraries: 'requests', 'pandas', 'json', 'dateutil', 're', 'time'.</li>
                        </ul>
                        <br><hr><br>
                        <h5>Step 1: Fetching Paginated Order Data</h5>
                        <p class="text-justify">First, we need to fetch paginated order data from Zomato's API. We start by obtaining valid headers from the browser to authenticate our requests. Then, we iterate through the paginated order history, fetching data for each page until we reach the last page. The fetched data is stored in a JSON file for further processing.</p>
                        <pre class="code-container"><code>import requests
import json

if __name__ == "__main__":
<span class="code-comment">
    # Replace with the headers obtained from your browser session</span>
    headers = {
        'accept': '',
        'accept-language': '',
        'cookie': '',
        'user-agent': '',
        'x-zomato-csrft': '',
        'referer': '',
        'sec-fetch-site': '',
    }

    dataset = []
    total_pages = None
    current_page = 1

    while True:
        if total_pages and current_page > total_pages:
            break

        url = f'https://www.zomato.com/webroutes/user/orders?page={current_page}'
        response = requests.get(url, headers=headers)
        data = response.json()
        total_pages = data['sections']['SECTION_USER_ORDER_HISTORY']['totalPages']
        dataset.append(data)
        current_page += 1

    with open('<span class="code-comment"># Complete path of your data.json file</span>', 'w') as f:
        json.dump(dataset, f)</code></pre>
                        <br><hr><br>
                        <h5>Step 2: Extracting Detailed Order Information</h5>
                        <p class="text-justify">Next, we will extract detailed information for each order item. This involves reading the JSON file containing the paginated order data, extracting unique identifiers (hash IDs) for each order item, and then fetching detailed information using another Zomato API endpoint.</p>
                        <pre class="code-container"><code>import time

if __name__ == "__main__":
<span class="code-comment">
    # Replace with the headers obtained from your browser session</span>
    headers = {
        'accept': '',
        'accept-language': '',
        'cookie': '',
        'user-agent': '',
        'x-zomato-csrft': '',
        'referer': '',
        'sec-fetch-site': '',
    }

    with open('<span class="code-comment"># Complete path of your data.json file</span>', 'r') as f:
        order_json = json.load(f)

    hashlist = []
    for page in order_json:
        for order in page['entities']['ORDER'].values():
            hashlist.append(order['hashId'])

    dataset = []
    for hash_id in hashlist:
        url = f'https://www.zomato.com/webroutes/order/details?hashId={hash_id}'
        response = requests.get(url, headers=headers)
        data = response.json()
        dataset.append({"hashid": hash_id, "data": data})
        time.sleep(0.5)

    with open('<span class="code-comment"># Complete path of your data_per_item.json file</span>', 'w') as f:
        json.dump(dataset, f)</code></pre>
                        <br><hr><br>
                        <h5>Step 3: Transforming JSON Files into CSV Files</h5>
                        <p class="text-justify">In this step, we will transform the JSON files into CSV files for easier analysis. We will create two CSV files: one for order data and another for detailed item information.</p>
                        <br><h6>Function to Process Order Data</h6>
                        <pre class="code-container"><code>import pandas as pd
import re
from dateutil import parser

def process_order_data(datafile, outfile, per_item_file):
    datacols = ['order_date', 'cost', 'payment_status', 'delivery_address', 'dish_string', 'restaurant_name', 'hashid', 'taxes', 'delivery_charge', 'packing_charge', 'discounts']
    dataset = []

    with open(per_item_file, 'r') as f:
        item_json = json.load(f)

    itemdict = {}
    for record in item_json:
        recdict = {}
        charge_dict = record['data']['details']['order']['items']

        taxes = sum(x['totalCost'] for x in charge_dict.get('tax', []))

        delivery_charge = next((x['totalCost'] for x in charge_dict.get('charge', []) if x['itemName'] == 'Delivery Charge'), 0)
        packing_charge = next((x['totalCost'] for x in charge_dict.get('charge', []) if x['itemName'] == 'Restaurant Packaging Charges'), 0)
        discounts = sum(x['totalCost'] for x in charge_dict.get('voucher_discount', []))

        costdict = {
            'taxes': taxes,
            'delivery_charge': delivery_charge,
            'packing_charge': packing_charge,
            'discounts': discounts,
        }

        itemdict[record['hashid']] = costdict

    currency_clean = re.compile(r'[^\d.,]+')

    with open(datafile, 'r') as f:
        jsondata = json.load(f)

    for page in jsondata:
        for order in page['entities']['ORDER'].values():
            hashid = order['hashId']
            row = [
                parser.parse(order['orderDate']),
                currency_clean.sub('', order['totalCost']),
                order['paymentStatus'],
                order['deliveryDetails']['deliveryAddress'],
                order['dishString'],
                order['resInfo']['name'],
                hashid,
                itemdict[hashid]['taxes'],
                itemdict[hashid]['delivery_charge'],
                itemdict[hashid]['packing_charge'],
                itemdict[hashid]['discounts'],
            ]
            dataset.append(row)

    df = pd.DataFrame(data=dataset, columns=datacols)
    df.to_csv(outfile, index=False)

<span class="code-comment"># Usage</span>
process_order_data('<span class="code-comment"># Complete path of your data.json file</span>', '<span class="code-comment"># Complete path of your orders.csv file</span>', '<span class="code-comment"># Complete path of your data_per_item.json file</span>')</code></pre>
                        <br><h6>Function to Parse Item Data</h6>
                        <pre class="code-container"><code>def parse_item_data(itemfile, itemoutfile):
    with open(itemfile, 'r') as f:
        datafile = json.load(f)

    datacols = ['hashid', 'itemname', 'unitcost', 'totalcost', 'quantity']
    dataset = []

    for item in datafile:
        hashid = item['hashid']
        item_data = item['data']['details']['order']['items'].get('dish', [])
        for dish in item_data:
            row = [hashid, dish['itemName'], dish['unitCost'], dish['totalCost'], dish['quantity']]
            dataset.append(row)

    df = pd.DataFrame(data=dataset, columns=datacols)
    df.to_csv(itemoutfile, index=False)

<span class="code-comment"># Usage</span>
parse_item_data('<span class="code-comment"># Complete path of your data_per_item.json file</span>', '<span class="code-comment"># Complete path of your items.csv file</span>')</code></pre>
                        <br><hr><br>
                        <h5>Step 4: Running the Code</h5>
                        <p class="text-justify">After updating the headers with your actual session details and saving the scripts, you can run them in your Python environment. This will generate two CSV files (`orders.csv` and `items.csv`) in the specified directory.</p>
                        <br><h6>Code to Execute the Functions</h6>
                        <pre class="code-container"><code>if __name__ == "__main__":
    <span class="code-comment"># Extract detailed order information</span>
    parse_item_data('<span class="code-comment"># Complete path of your data_per_item.json file</span>', '<span class="code-comment"># Complete path of your items.csv file</span>')

    <span class="code-comment"># Process order data</span>
    process_order_data('<span class="code-comment"># Complete path of your data.json file</span>', '<span class="code-comment"># Complete path of your orders.csv file</span>', '<span class="code-comment"># Complete path of your data_per_item.json file</span>')</code></pre>
                        <br><hr><br>
                        <h5>Conclusion</h5>
                        <p class="text-justify">In this blog post, we have explored how to use Zomato's API to scrape order data. We fetched paginated order data, extracted detailed order information, and transformed the data into CSV files for analysis. This dataset can now be easily analysed using tools like Tableau, Power BI, or Excel.</p>
                        <br>
                    </p></div>
                </div>
            </div>
        </div>
        <!-- About End -->


        <!-- Portfolio Start -->
        <div class="portfolio" id="portfolio">
            <div class="container">
                <div class="section-header text-center wow zoomIn" data-wow-delay="0.1s">
                    <p>My Portfolio</p>
                </div>
                <div class="row">
                    <div class="col-12">
                        <ul id="portfolio-filter">
                            <li data-filter="*" class="filter-active">All</li>
                            <li data-filter=".filter-1">Projects</li>
                            <li data-filter=".filter-2">Blogs</li>
                            <li data-filter=".filter-3">Articles</li>
                        </ul>
                    </div>
                </div>

                <div class="row portfolio-container">
                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-1">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/project3.png" alt="Project3" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Evaluating the Magnitude of Prejudice in Media Reporting and its Impact on Voters’ Judgement<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> August 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Descriptive Analysis, Hypothesis Testing, Sentiment Analysis</p>
                                </div>
                                <a class="btn" href="projectmsa.html">Ongoing<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-1">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/project2.png" alt="Project2" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Building a Scalable Data Pipeline for UK Grocery Price Analysis: A Real-Time Retail Insights Project<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> June 23, 2024<br>-->
                                    <i class="fas fa-tag"></i> Data Engineering, ETL Pipeline, Cloud-Based Analytics, Automated Web Scraping</p>
                                </div>
                                <a class="btn" href="projectgroc.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-2">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/blog5.png" alt="Blog5" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Recommending Marketing Strategy: Optimizing Revenue Through Customer Behavior Data<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Predictive Modeling, Customer Behavior, Revenue Optimization, Regression Analysis</p>
                                </div>
                                <a class="btn" href="blogcbms.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-1">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/project1.png" alt="Project1" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Comprehensive Year-End Sales and Performance Analysis for Universal Export<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Data Cleaning, Data Transformation, Power BI, Data Visualisation</p>
                                </div>
                                <a class="btn" href="projectue.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-2">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/blog4.png" alt="Blog4" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Strategic Analysis and Decision-Making for SparkSwift: Entering the Autonomous EV Market in Esperanto<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Business Analysis, Consulting, Data-Driven Decision Making</p>
                                </div>
                                <a class="btn" href="blogconsult.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-3">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/article2.png" alt="Article2" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Critical Analysis of Prospect Theory in Product Pricing: Behavioral Economics in Market Strategy<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Behavioral Economics, Pricing Strategy Analysis, Risk Assessment</p>
                                </div>
                                <a class="btn" href="articlept.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-2">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/blog3.png" alt="Blog3" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Strategising Autonomous Delivery Trial: Maximising Delivery while Minimising the Cost and Manpower<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Optimization Analysis, Multi-Criteria Decision Analysis, R, Linear Programming</p>
                                </div>
                                <a class="btn" href="bloglp.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-2">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/blog1.webp" alt="Blog1" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Forecasting the Personal Consumption Expenditure in the United States<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Data Forecasting, R</p><br>
                                </div>
                                <a class="btn" href="blogpce.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-6 mb-4 portfolio-item filter-3">
                        <div class="blog-item wow fadeInUp" data-wow-delay="0.1s">
                            <div class="portfolio-img">
                                <img src="img/article1.jpg" alt="Artcle1" class="img-fluid">
                            </div>
                            <div class="blog-text">
                                <h6>Deciphering the dynamics of Voter Turnout: Evaluation of field experiments and Implications of Behaviour Change Theory<br></h6>
                                <div class="blog-meta" style="font-size: 13px;">
                                    <p><!--<i class="far fa-calendar-alt"></i> April 30, 2024<br>-->
                                    <i class="fas fa-tag"></i> Optimization Techniques</p>
                                </div>
                                <a class="btn" href="articlebct.html">View<i class="fa fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Portfolio End -->


        <!-- Footer Start -->
        <div class="footer wow fadeIn" data-wow-delay="0.3s" id="contact">
            <div class="container-fluid">
                <div class="container">
                    <div class="footer-info">
                        <div class="section-header text-center">
                            <h7 style="background-color: #607274; color: #F8EDE3;"><b>GET IN TOUCH</b></h7>
                        </div>
                        <h2>Ayush Kumar</h2>
                        <h3>Leeds, United Kingdom</h3>
                        <div class="footer-social">
                            <a href="tel:+447425628440"><i class="fas fa-phone-alt"></i></a>
                            <a href="mailto:ayush22kumar97@gmail.com"><i class="fas fa-envelope"></i></a>
                            <a href="https://www.linkedin.com/in/ayush-kumar-401955117/"><i class="fab fa-linkedin-in"></i></a>
                            <a href="https://github.com/ayush22kumar97" target="_blank"><i class="fab fa-github"></i></a>
                        </div>       
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->
        
        
        <!-- Back to top button -->
        <a href="#" class="btn back-to-top"><i class="fa fa-chevron-up"></i></a>
         
        <!-- Pre Loader -->
        <div id="loader" class="show">
            <div class="loader"></div>
        </div>

        <!-- JavaScript Libraries -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
        <script src="lib/easing/easing.min.js"></script>
        <script src="lib/wow/wow.min.js"></script>
        <script src="lib/waypoints/waypoints.min.js"></script>
        <script src="lib/typed/typed.min.js"></script>
        <script src="lib/owlcarousel/owl.carousel.min.js"></script>
        <script src="lib/isotope/isotope.pkgd.min.js"></script>
        <script src="lib/lightbox/js/lightbox.min.js"></script>
        
        <!-- Contact Javascript File -->
        <script src="mail/jqBootstrapValidation.min.js"></script>
        <script src="mail/contact.js"></script>

        <!-- Template Javascript -->
        <script src="js/main.js"></script>
    </body>
</html>